#!/usr/bin/env bash

# MNEMONIC: [F]uzzy search for [D]otfile git [A]dd
# SYNOPSIS: fda
# DESCRIPTION: Fuzzy finder for the unstaged files in my dotfile bare repository
# and git add the selections

prefix="git --git-dir=$HOME/dotfiles/ --work-tree=$HOME"
preview="[[ ! -e {} ]] && echo 'No preview for deleted file.' || $prefix diff --color=always {} | delta --width \${FZF_PREVIEW_COLUMNS:-\$COLUMNS} --file-style omit"

files=($(eval "$prefix diff --name-only" | sed "s~^~$HOME/~" \
  | fzf --exit-0 --height 100% --preview "$preview" --preview-window down,70%,border-up --prompt="DotAdd> " --header ":: ENTER (dot add the selected files)"))

if [[ -n $files ]]; then
  eval "$prefix add ${files[@]}"
fi
